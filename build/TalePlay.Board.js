(function(e,t,r,l){var o=this.TalePlay=this.TalePlay||{},s=r("shortcut")({rs:"rescope",node:"NodePatch"}),i="analogStickChanged buttonChanged",a=o.Board=e.Class({init:function(e){this.controllers=[],this.nodePatch=new s.node(this,{children:"layers",addChild:"addLayer",removeChild:"removeLayer",hasChild:"hasLayer"}),this.disabled=!1,this.playerDisabled={},s.rs.all(["focus"],this),this.domElement=document.createElement("div"),this.domElement.classList.add("Board"),this.keyTrigger=document.createElement("textarea"),this.domElement.appendChild(this.keyTrigger),this.keyTrigger.classList.add("keyTrigger"),this.keyTrigger.style.position="absolute",this.keyTrigger.style.zIndex="-1",this.keyTrigger.style.height=this.keyTrigger.style.width="0",this.keyTrigger.style.resize="none",this.domElement.addEventListener("click",this.focus,!1),e&&e.appendChild(this.domElement)},setDisabled:function(){},setPlayerDisabled:function(){},addController:function(e,t){this.removeController(e),this.controllers.push({controller:e,player:t||1}),e.addListener(i,this,"_ctrlCallback"),l("Controller.Keyboard")&&e instanceof r("Controller.Keyboard")&&e.setDomElement(this.keyTrigger)},removeController:function(e){for(var t=this.controllers.length-1;t>=0;t--)if(this.controllers[t].controller===e)return e.removeListener(i,this,"_ctrlCallback"),l("Controller.Keyboard")&&e instanceof r("Controller.Keyboard")&&e.setDomElement(),this.controllers.splice(t,1),!0;return!1},setControllerDisabled:function(){},_ctrlCallback:function(e){if(!this.disabled&&this.layers.length>0){Array.prototype.slice.call(arguments,0),e.player=null;for(var t=this.controllers.length-1;t>=0;t--)if(this.controllers[t].controller===e.source){e.player=t;break}this.playerDisabled[e.player]||this.layers[this.layers.length-1].onController(e)}},addLayer:function(e){return l("Layer")&&e instanceof r("Layer")&&this.nodePatch.addChild(e)?(this.domElement.appendChild(e.domElement),!0):!1},removeLayer:function(e){return this.nodePatch.removeChild(e)?(e.domElement.remove(),!0):!1},focus:function(e){(!e||"INPUT"!==e.target.tagName&&"SELECT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName)&&this.keyTrigger.focus()}});t("Board",a)})(Morgas,Morgas.setModule,Morgas.getModule,Morgas.hasModule);